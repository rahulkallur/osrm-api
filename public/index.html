<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OSRM Express App</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #map { height: 400px; margin-top: 20px; border: 1px solid #ccc; }
    input { margin: 5px; }
    button { margin: 5px; }
    .result { margin-top: 15px; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; }
  </style>
</head>
<body>
  <h2>ðŸš€ OSRM API with Express</h2>

  <h3>Get Address from Coordinates</h3>
  <input type="text" id="lat" placeholder="Latitude" />
  <input type="text" id="lon" placeholder="Longitude" />
  <button onclick="getAddress()">Get Address</button>
  <div id="addressResult" class="result"></div>

  <h3>Get Route Between Coordinates</h3>
  <input type="text" id="startLat" placeholder="Start Latitude" />
  <input type="text" id="startLon" placeholder="Start Longitude" />
  <input type="text" id="endLat" placeholder="End Latitude" />
  <input type="text" id="endLon" placeholder="End Longitude" />
  <button onclick="getRoute()">Get Route</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map("map").setView([20, 77], 5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Â© OpenStreetMap contributors",
    }).addTo(map);

    let routeLayer;

    async function getAddress() {
      const lat = document.getElementById("lat").value;
      const lon = document.getElementById("lon").value;

      const res = await fetch(`/api/address?lat=${lat}&lon=${lon}`);
      const data = await res.json();

      document.getElementById("addressResult").innerHTML = `
        <strong>Address:</strong> ${data.address || "Not found"}
      `;

      if (lat && lon) {
        map.setView([lat, lon], 14);
        L.marker([lat, lon]).addTo(map).bindPopup(data.address).openPopup();
      }
    }

    async function getRoute() {
      const startLat = document.getElementById("startLat").value;
      const startLon = document.getElementById("startLon").value;
      const endLat = document.getElementById("endLat").value;
      const endLon = document.getElementById("endLon").value;

      const res = await fetch(`/api/route?startLat=${startLat}&startLon=${startLon}&endLat=${endLat}&endLon=${endLon}`);
      const data = await res.json();

      if (routeLayer) {
        map.removeLayer(routeLayer);
      }

      if (data.routes && data.routes.length > 0) {
        const coords = data.routes[0].geometry.coordinates.map(([lon, lat]) => [lat, lon]);
        routeLayer = L.polyline(coords, { color: "blue", weight: 5 }).addTo(map);
        map.fitBounds(routeLayer.getBounds());
      }
    }
  </script>
</body>
</html>